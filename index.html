<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Marine BGC Database</title>
<style>
    body { font-family: Arial, sans-serif; background: #f4f6f8; text-align: center; margin:0; padding:0; }
    header { background: #1a5276; color: white; padding: 30px 20px; }
    header img.logo { width:120px; background:white; padding:5px; border-radius:10px; margin-bottom:15px; }
    header h1 { margin:10px 0; font-size:2em; }
    header p { font-size:1.1em; max-width:700px; margin:0 auto; }
    .container { width:95%; margin:30px auto; background:white; padding:15px; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.1); }
    .download-btn { display:inline-block; padding:12px 25px; margin:15px 10px; background-color:#2874a6; color:white; text-decoration:none; font-size:1em; border-radius:8px; transition: background 0.3s; }
    .download-btn:hover { background-color:#1a5276; }
    footer { background:#1a5276; color:white; padding:15px; margin-top:30px; }
    table.dataTable { width:100% !important; }
</style>

<!-- DataTables CSS -->
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">

<!-- PapaParse -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<!-- DataTables JS -->
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>

</head>
<body>

<header>
    <img src="logo.png" class="logo" alt="Project Logo">
    <h1>Marine Microbial BGC Database</h1>
    <p>A curated and ranked database of marine microbial biosynthetic gene clusters (BGCs). Explore, search, and optionally download the dataset below.</p>
</header>

<div class="container">
    <a class="download-btn" href="https://docs.google.com/spreadsheets/d/e/2PACX-1vTxABHo1mwwqSzLZOb0Sqw0ZEnnddbV4u8TCfJOR_QeWgXqH2YHcrISrdqWanQvS-NhHDwML_ecH81f/pub?output=csv" target="_blank">View / Download CSV</a>

    <table id="bgcTable" class="display">
        <thead>
            <tr>
                <th>Organism</th>
                <th>Reference</th>
                <th>Similarity_Score</th>
                <th>Novelty_score</th>
                <th>Cluster_Rank</th>
                <th>BGC_Type</th>
                <th>Compounds</th>
                <th>Matched_Organism</th>
                <th>Habitat</th>
                <th>Source</th>
            </tr>
        </thead>
        <tbody>
            <!-- Table rows will be loaded dynamically from CSV -->
        </tbody>
    </table>
</div>

<footer>
    Marine BGC Database | Powered by GitHub Pages
</footer>

<script>
$(document).ready(function() {
    const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTxABHo1mwwqSzLZOb0Sqw0ZEnnddbV4u8TCfJOR_QeWgXqH2YHcrISrdqWanQvS-NhHDwML_ecH81f/pub?output=csv";

    Papa.parse(csvUrl, {
        download: true,
        header: true,
        skipEmptyLines: true,
        complete: function(results) {
            console.log("Columns detected:", Object.keys(results.data[0]));

            // Filter out rows where mandatory columns are empty
            const cleanData = results.data.filter(row => row.Organism && row.Reference);

            // Initialize DataTable
            $('#bgcTable').DataTable({
                data: cleanData,
                columns: [
                    { data: 'Organism' },
                    { 
                        data: 'Reference',
                        render: function(data, type, row) {
                            if(data) {
                                return '<a href="https://mibig.secondarymetabolites.org/repository/'+data+'" target="_blank">'+data+'</a>';
                            }
                            return '';
                        }
                    },
                    { data: 'Similarity_Score' },
                    { data: 'Novelty_score' },
                    { data: 'Cluster_Rank' },
                    { data: 'BGC_Type' },
                    { data: 'Compounds' },
                    { data: 'Matched_Organism' },
                    { data: 'Habitat' },
                    { data: 'Source' }
                ],
                paging: true,
                searching: true,
                ordering: true
            });
        },
        error: function(err) {
            console.error("Error loading CSV:", err);
            alert("Failed to load CSV. Please check the CSV URL.");
        }
    });
});
</script>

</body>
</html>
